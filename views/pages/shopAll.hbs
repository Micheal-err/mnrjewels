<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">


<style>

/* ================= SIDEBAR ================= */
.filter-sidebar {
  background: #F4F6F8;
  border-radius: 14px;
  padding: 22px;
  box-shadow: 0 20px 50px rgba(0,0,0,.08);
  height: 80vh;
}

.filter-block { margin-bottom: 22px; }

.filter-block h6 {
  font-size: 14px;
  font-weight: 600;
  margin-bottom: 10px;
  font-size: 1.2rem;
}

.filter-block p {
  display: flex;
  align-items: center;
  gap: 10px;
  margin: 6px 0;
  font-size: 1rem;
}

.filter-block input {
  width: 16px;
  height: 16px;
}

.apply-btn, .clear-btn {
  width: 80%;
  border-radius: 10px;
  font-weight: 600;
  font-size: 1rem;
}

.apply-btn {
  background: #9FA878;
  color: #fff;
  border: none;
}

.clear-btn {
  background: #9FA878;
  color: white;
  margin-top: 10px;
  border: none;
}

/* ================= GRID ================= */
.shop-modern {
  display: flex;
  flex-wrap: wrap;
  margin-left: 0px;
  margin-right: 0px;
}

.grid-item {
  width: 20%;
  margin-bottom: 1rem;
}

@media (max-width: 991px) {
  .grid-item { width: 33.333%; }
}

@media (max-width: 767px) {
  .grid-item { width: 50%; }
}

.shop-box {
  background: #9FA878;
  border-radius: 14px;
  padding: 14px;
  color: white !important;
}

.shop-image img {

  width: 100%;  
  height: 336px;
  border-radius: 10px;
}

.shop-footer {
  margin-top: 10px;
  color: white;
}

.wishlist-btn {
  width: 44px;
  height: 44px;
  border-radius: 8px;
  border: none;
  background: #fff;
  color: #aaa;
  margin-left: 5px;
}

.wishlist-btn.active {
  color: var(--base-color);
}
.grid-sizer {
  width: 0 !important;
  height: 0 !important;
  padding: 0 !important;
  margin: 0 !important;
  position: absolute !important;
  visibility: hidden !important;
}

.btn:hover{
  background-color: #fff !important;
  color: #9FA878 !important;
}


/* ================= MOBILE FILTER DRAWER ================= */
@media (max-width: 991px) {

  body.filter-open {
    overflow: hidden;
  }

  .filter-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,.45);
    z-index: 998;
    opacity: 0;
    pointer-events: none;
    transition: opacity .3s ease;
  }

  .filter-overlay.show {
    opacity: 1;
    pointer-events: auto;
  }

  .filter-sidebar {
    position: fixed;
    top: 0;
    left: -100%;
    width: 85%;
    max-width: 320px;
    height: 100vh;
    z-index: 999;
    overflow-y: auto;
    border-radius: 0;
    transition: left .35s cubic-bezier(.22,.61,.36,1);
  }

  .filter-sidebar.show {
    left: 0;
  }

  .filter-close {
    display: block;
    text-align: right;
    margin-bottom: 10px;
  }

}

/* ================= GRID FIX FOR SMALL SCREENS ================= */
@media (max-width: 575px) {
  .grid-item {
    width: 100%;
  }

  .shop-image img {
    height: auto;
  }

  .apply-btn,
  .clear-btn {
    width: 100%;
  }
}
@media (max-width: 991px) {
  .filter-sidebar {
    padding: 22px 18px;
  }
  .shop-modern{
    justify-content: center;
    margin-right: 0 !important;
  }
  
}
@media (max-width: 1440px) {
.container{
  margin-left: 0;
  margin-right: 0;
}
.grid-item{
  width: 25%;
}
}

@media (max-width: 1440px) {
.shop-modern{
      margin-right: -53px;

}
.grid-item{
  width: 30%;
}
.filter-sidebar {
  margin-top: 4.5rem;
}
}

@media (max-width: 991px) {
.shop-modern{
      margin-right: -53px;

}
.grid-item{
  width: 30%;
}
.filter-sidebar {
  margin-top: 0rem;
}
}

@media (max-width: 768px) {
.shop-modern{
      margin-right: -0px;
      justify-content: center;

}
.grid-item{
  width: 50%;
}
}
@media (max-width: 575px) {

.grid-item{
  width: 80%;
}

}
@media (max-width: 425px) {

.grid-item{
  width: 90%;
}

}
@media (max-width: 375px) {

.grid-item{
  width: 100%;
}

}



</style>

<div class="container mt-6">
  <div class="row">

    <!-- SIDEBAR -->
    <aside class="col-lg-2 filter-sidebar">
      <form id="filterForm">

        <div class="filter-block">
          <h6>Sort by</h6>
          <p><input type="radio" name="sort" value="new" checked> New arrivals</p>
          <p><input type="radio" name="sort" value="high"> Price: High to Low</p>
          <p><input type="radio" name="sort" value="low"> Price: Low to High</p>
        </div>

        <div class="filter-block">
          <h6>Price range</h6>
          <p><input type="checkbox" name="price" value="0-1000"> 0 – 1000</p>
          <p><input type="checkbox" name="price" value="1000-2000"> 1000 – 2000</p>
          <p><input type="checkbox" name="price" value="2000-4000"> 2000 – 4000</p>
          <p><input type="checkbox" name="price" value="4000+"> 4000+</p>
        </div>

        <div class="filter-block">
          <h6>Finish</h6>
          <p><input type="checkbox" name="finish" value="silver"> Silver</p>
          <p><input type="checkbox" name="finish" value="gold"> Gold</p>
          <p><input type="checkbox" name="finish" value="rose"> Rose Gold</p>
        </div>

        <button class="apply-btn">Apply</button>
        <button type="button" id="clearFilters" class="clear-btn">Reset</button>

      </form>
    </aside>

    <!-- PRODUCTS -->
    <main class="col-lg-9">

      <div class="mb-3">
        <span id="productCount">{{totalProducts}} products</span>
      </div>

      <!-- IMPORTANT: THIS IS SSR CONTENT -->
      <div id="productsContainer">
        <ul class="shop-modern">

          {{#each collections}}
            {{#each this}}
              <li class="grid-item">
                <div class="shop-box">

                  <div class="shop-image">
                    <a href="/product/{{id}}">
                      <img src="/uploads/{{image1}}" alt="{{name}}">
                    </a>
                  </div>

                  <div class="shop-footer">
                    <a href="/product/{{id}}">{{name}}</a>
                    <p>₹{{price}}</p>
                  </div>

                  <div class="d-flex gap-2">
                    <button class="btn bg-base-color text-white w-100 add-cart-btn" data-id="{{id}}">
                      ADD TO CART
                    </button>
                    <button class="wishlist-btn" data-id="{{id}}">
                      <i class="fa-solid fa-heart"></i>
                    </button>
                  </div>

                </div>
              </li>
            {{/each}}
          {{/each}}

        </ul>
      </div>

    </main>
  </div>
</div>
<script>
(() => {

  const form = document.getElementById("filterForm");
  const container = document.getElementById("productsContainer");
  const productCount = document.getElementById("productCount");
  const token = localStorage.getItem("token");

  if (!form || !container) return;

  /* FILTER SUBMIT (AJAX ONLY WHEN USER CLICKS APPLY) */
  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    const fd = new FormData(form);
    const params = new URLSearchParams();

    for (const [k, v] of fd.entries()) {
      params.has(k)
        ? params.set(k, params.get(k) + "," + v)
        : params.set(k, v);
    }

    const res = await fetch(`${location.pathname}?${params}`, {
      headers: { "X-Requested-With": "XMLHttpRequest" }
    });

    const data = await res.json();

    renderProducts(data.products || []);
    productCount.textContent = `${data.totalProducts || 0} products`;
    history.replaceState({}, "", "?" + params.toString());
  });

  /* RESET = FULL PAGE RELOAD (SSR SAFE) */
  document.getElementById("clearFilters").onclick = () => {
    location.href = location.pathname;
  };

  function renderProducts(products) {
    if (!products.length) {
      container.innerHTML = `<p class="text-center mt-5">No products found</p>`;
      return;
    }

    container.innerHTML = `
      <ul class="shop-modern">
        ${products.map(p => `
          <li class="grid-item">
            <div class="shop-box">
              <div class="shop-image">
                <a href="/product/${p.id}">
                  <img src="/uploads/${p.image1}">
                </a>
              </div>
              <div class="shop-footer">
                <a href="/product/${p.id}">${p.name}</a>
                <p>₹${p.price}</p>
              </div>
              <div class="d-flex gap-2">
                <button class="btn bg-base-color text-white w-100 add-cart-btn" data-id="${p.id}">
                  ADD TO CART
                </button>
                <button class="wishlist-btn" data-id="${p.id}">
                  <i class="fa-solid fa-heart"></i>
                </button>
              </div>
            </div>
          </li>
        `).join("")}
      </ul>
    `;
  }

})();
</script>
